"use strict";(self.webpackChunkkeep_being_human_dev=self.webpackChunkkeep_being_human_dev||[]).push([[81478],{65404:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var i=t(36672);const o={},r=i.createContext(o);function s(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(r.Provider,{value:n},e.children)}},80384:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>m,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"rails/deployment/expert/zero_downtime_db_migrations","title":"zero_downtime_db_migrations","description":"\ud83d\udd04 Zero-Downtime DB Migrations","source":"@site/docs/rails/deployment/expert/zero_downtime_db_migrations.md","sourceDirName":"rails/deployment/expert","slug":"/rails/deployment/expert/zero_downtime_db_migrations","permalink":"/keep-being-human-dev/docs/rails/deployment/expert/zero_downtime_db_migrations","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/rails/deployment/expert/zero_downtime_db_migrations.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"docker_cache_optimization","permalink":"/keep-being-human-dev/docs/rails/deployment/expert/docker_cache_optimization"},"next":{"title":"capistrano_custom_tasks","permalink":"/keep-being-human-dev/docs/rails/deployment/middle/capistrano_custom_tasks"}}');var o=t(23420),r=t(65404);const s={},a=void 0,d={},c=[{value:"\ud83d\udd04 Zero-Downtime DB Migrations",id:"-zero-downtime-db-migrations",level:2}];function l(e){const n={code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"-zero-downtime-db-migrations",children:"\ud83d\udd04 Zero-Downtime DB Migrations"}),"\n",(0,o.jsxs)(n.p,{children:["Leverage ActiveRecord\u2019s ",(0,o.jsx)(n.code,{children:"disable_ddl_transaction!"})," combined with algorithm options to execute migrations without blocking your application. Use the Strong Migrations gem or manual techniques to split long\u2010running changes into safe, granular steps and integrate checks in your CI pipeline to prevent locking."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ruby",children:"class AddIndexConcurrentlyToUsersEmail < ActiveRecord::Migration[6.1]\n  disable_ddl_transaction!\n\n  def up\n    add_index :users, :email, algorithm: :concurrently\n  end\n\n  def down\n    remove_index :users, :email, algorithm: :concurrently\n  end\nend\n"})}),"\n",(0,o.jsx)(n.p,{children:"In your GitLab CI or GitHub Actions pipeline, enforce Strong Migrations checks:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"# .gitlab-ci.yml\nmigrations:\n  stage: test\n  script:\n    - bundle exec rake db:migrate:status\n    - bundle exec strong_migrations:check\n  allow_failure: false\n"})})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}}}]);