"use strict";(self.webpackChunkkeep_being_human_dev=self.webpackChunkkeep_being_human_dev||[]).push([[72518],{65404:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>s});var r=n(36672);const i={},o=r.createContext(i);function a(e){const t=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(o.Provider,{value:t},e.children)}},98412:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>l,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"rails/encryption/expert/rotate_encryption_keys","title":"rotate_encryption_keys","description":"\ud83d\udd11 Implement Encryption Key Rotation with Multiple Keys","source":"@site/docs/rails/encryption/expert/rotate_encryption_keys.md","sourceDirName":"rails/encryption/expert","slug":"/rails/encryption/expert/rotate_encryption_keys","permalink":"/keep-being-human-dev/docs/rails/encryption/expert/rotate_encryption_keys","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/rails/encryption/expert/rotate_encryption_keys.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"authenticated_encryption_with_aad","permalink":"/keep-being-human-dev/docs/rails/encryption/expert/authenticated_encryption_with_aad"},"next":{"title":"active_record_encryption_config","permalink":"/keep-being-human-dev/docs/rails/encryption/middle/active_record_encryption_config"}}');var i=n(23420),o=n(65404);const a={},s=void 0,p={},c=[{value:"\ud83d\udd11 Implement Encryption Key Rotation with Multiple Keys",id:"-implement-encryption-key-rotation-with-multiple-keys",level:2}];function y(e){const t={code:"code",h2:"h2",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"-implement-encryption-key-rotation-with-multiple-keys",children:"\ud83d\udd11 Implement Encryption Key Rotation with Multiple Keys"}),"\n",(0,i.jsxs)(t.p,{children:["Managing rotating encryption keys is critical for maintaining data security without downtime. Leverage ActiveSupport::MessageEncryptor's ",(0,i.jsx)(t.code,{children:"rotate"})," API to support decrypting with previous keys while using the latest primary key for encryption. Store your keys in ",(0,i.jsx)(t.code,{children:"Rails.application.credentials"})," (or a vault) as an array for previous keys and a separate entry for the primary key."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ruby",children:"# config/initializers/encryption.rb\nprimary_key = Rails.application.key_generator.generate_key(\n  Rails.application.credentials.encryption[:primary_key], 32\n)\nprevious_keys = Rails.application.credentials.encryption[:previous_keys].map do |raw_key|\n  Rails.application.key_generator.generate_key(raw_key, 32)\nend\n\nencryptor = ActiveSupport::MessageEncryptor.new(\n  primary_key,\n  cipher: 'aes-256-gcm'\n)\n# Allow decryption with older keys\nencryptor.rotate(previous_keys)\n\n# Usage:\nciphertext = encryptor.encrypt_and_sign('HighlySensitiveData')\n# decrypts seamlessly with primary or any rotated key\nplaintext  = encryptor.decrypt_and_verify(ciphertext)\n"})})]})}function l(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(y,{...e})}):y(e)}}}]);